<!DOCTYPE html>
<html>
<head>
    <title>Chat Room</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            display: flex;
            flex-direction: column;
            height: 100vh;
            margin: 0;
        }

        header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            background: #aa00ff;
            color: white;
        }

        #chat {
            flex: 1;
            padding: 10px;
            overflow-y: auto;
            background: #f5f5f5;
            display: flex;
            flex-direction: column;
        }

        .message {
            max-width: 60%;
            padding: 8px 12px;
            margin: 4px 0;
            border-radius: 12px;
            word-wrap: break-word;
        }

        .me {
            align-self: flex-end;
            background: #d1f7c4;
        }

        .other {
            align-self: flex-start;
            background: #fff;
            border: 1px solid #ddd;
        }

        .system {
            align-self: center;
            font-size: 0.9em;
            color: #666;
            background: none;
            padding: 2px;
            margin: 6px 0;
        }

        #form {
            display: flex;
            padding: 10px;
            background: #eee;
        }

        #input {
            flex: 1;
            padding: 10px;
            border: none;
            border-radius: 8px;
            outline: none;
        }

        button {
            padding: 8px 16px;
            margin-left: 8px;
            border: none;
            background: #28a745;
            color: white;
            border-radius: 8px;
            cursor: pointer;
        }

        button:hover {
            background: #218838;
        }

        .logout-btn {
            background: #dc3545;
            margin-left: 0;
        }

        .logout-btn:hover {
            background: #c82333;
        }
    </style>
</head>
<body>
    <header>
        <div>Logged in as: <b>{{ username }}</b></div>
        <form action="{{ url_for('logout') }}" method="get">
            <button type="submit" class="logout-btn">Logout</button>
        </form>
    </header>

    <div id="chat"></div>

    <form id="form">
        <input id="input" autocomplete="off" placeholder="Type a message..." />
        <button>Send</button>
    </form>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.6.1/socket.io.min.js"></script>
    <script>
        const socket = io({ transports: ["websocket"] });
        const form = document.getElementById("form");
        const input = document.getElementById("input");
        const chat = document.getElementById("chat");

        const username = "{{ username }}";

        function addMessage(text, type) {
            const div = document.createElement("div");
            div.classList.add("message", type);
            div.textContent = text;
            chat.appendChild(div);
            chat.scrollTop = chat.scrollHeight;
        }

        form.addEventListener("submit", function(e) {
            e.preventDefault();
            if (input.value) {
                socket.send(input.value);
                addMessage(`You: ${input.value}`, "me");
                input.value = "";
            }
        });

        socket.on("chat", function(data) {
            if (data.username === username) return;
            addMessage(`${data.username}: ${data.message}`, "other");
        });

        socket.on("system", function(msg) {
            addMessage(msg, "system");
        });
    </script>
</body>
</html>
